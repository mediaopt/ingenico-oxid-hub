#!/usr/bin/env php
<?php

// Checking for CLI parameters
if ( !isset( $argv[1] ) )
{
    echo "Spcification of Oxid eShop instllation directory required.\n";
    exit( 1 );
}

if ( !isset( $argv[2] ) )
{
    echo "Spcification of file with module extensions required.\n";
    exit( 2 );
}

// Handling CLI parameters
$extensions = array_filter( array_map( 'trim', file( $argv[2] ) ) );
function getShopbasePath()
{
    global $argv;
    return $argv[1] . '/';
}

// Setting the module extensions
require getShopbasePath() . '/core/oxfunctions.php';

$oCfg = @oxRegistry::getConfig();

$aModules = $oCfg->getConfigParam( 'aModules' );
foreach ( $extensions as $line )
{
    list( $class, $extension ) = preg_split( '(\\s*=>\\s*)', $line );

    if ( !isset( $aModules[$class] ) )
    {
        $aModules[$class] = $extension;
    }
    else
    {
        $aModules[$class] = implode( '&', array_unique( array_merge( explode( '&', $aModules[$class] ), array( $extension ) ) ) );
    }
}
$oCfg->saveShopConfVar( 'aarr', 'aModules', $aModules );

